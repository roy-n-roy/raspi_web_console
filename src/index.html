<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>RasPi Remote Console</title>
	<style type="text/css">
		video {
			width: 100%;
			object-fit: scale-down;
		}
	</style>
</head>
<body>
	<script src="/js/socket.io.slim.js"></script>
	<script src="/js/hls.min.js"></script>
	<video id="video" autoplay muted></video>
	<script>
		// 画面再生
		if(Hls.isSupported()) {
			var video = document.getElementById('video');
			var hls = new Hls();
			hls.loadSource('/screan');
			hls.attachMedia(video);
			hls.on(Hls.Events.MANIFEST_PARSED,function() {
				video.play();
			});
		}

		// イベントとコールバックの定義
		var socket = io.connect("/");

		// ソケット切断時
		socket.on("disconnect", function(){
			if (window.confirm("切断されました。再接続しますか?")){
				socket = socket.connect();
			};
		});

		// マウス・キーボード入力時
		window.onload=function(){
			// キーボード: keydown
			window.addEventListener('keydown', function(event){
				socket.emit('keydown', event.code);
				// デフォルトイベントをキャンセル
				event.preventDefault();
			}, false);
			// キーボード: keyup
			window.addEventListener('keyup', function(event){
				socket.emit('keyup', event.code);
				// デフォルトイベントをキャンセル
				event.preventDefault();
			}, false);
			// マウス: mousemove
			window.addEventListener('mousemove', function(event){
				socket.emit('mousemove', event.movementX, event.movementY);
			});
			// マウス: mousedown
			window.addEventListener('mousedown', function(event){
				socket.emit('mousedown', event.button);
			});
			// マウス: mouseup
			window.addEventListener('mouseup', function(event){
				socket.emit('mouseup', event.button);
			});
			// wheel
			window.addEventListener('wheel', function(event){
				socket.emit('wheel', event.deltaX, event.deltaY);
				// デフォルトイベントをキャンセル
				event.preventDefault();
			}, false);
			// contextmenu
			window.addEventListener("contextmenu", function(event){
				// デフォルトイベントをキャンセル
				event.preventDefault();
			}, false);
		}
	</script>
</body>
</html>